var all_sockets = null;

var antiSpam = require('socket-anti-spam');
var antiSpam = new antiSpam({
    spamCheckInterval: 3000, // define in how much miliseconds the antispam script gives a minus spamscore point
    spamMinusPointsPerInterval: 3, // how many minus spamscore points after x miliseconds?
    spamMaxPointsBeforeKick: 9, // needed points before kick
    spamEnableTempBan: true, // Enable the temp ban system (temp ban users after x amount of kicks within x amount of time)
    spamKicksBeforeTempBan: 3, // This many kicks needed for a temp ban
    spamTempBanInMinutes: 10, // This many minutes temp ban will be active
    removeKickCountAfter: 1, // This many minutes until the kick counter is decreasing with 1 for the user
    debug: false // debug? not needed
});

exports.set_sockets = function(sockets) {
    all_sockets = sockets;
};

exports.connect_chatter = function(config) {
    var sala = config.sala || "principal";
    var socketHandler = require('./server-io-handler')(sala,config.io,config.socket);

    antiSpam.onConnect(config.socket);

    config.socket.on('image message', socketHandler.image_message);
    config.socket.on('chat message', socketHandler.chat_message);
    config.socket.on('prvt message', socketHandler.prvt_message);
    config.socket.on('changeData', socketHandler.change_data);
    config.socket.on('disconnect', socketHandler.disconnect);

    config.socket.on('get images', socketHandler.get_images);
};